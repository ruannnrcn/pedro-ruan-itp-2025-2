# Makefile para o Sistema de Produtos
CC = gcc
CFLAGS = -Wall -I$(SRC_DIR)
GTK_CFLAGS = $(shell pkg-config --cflags gtk+-3.0)
GTK_LIBS = $(shell pkg-config --libs gtk+-3.0)

# Diret√≥rios
SRC_DIR = src/app
VIEW_DIR = src/view
BUILD_DIR = build

# Execut√°veis
TARGET_CLI = produto_cli
TARGET_GUI = produto_gui
TARGET_ORIGINAL = produto


# Arquivos fonte
CORE_SOURCES = $(SRC_DIR)/produto_core.c
CLI_SOURCES = $(SRC_DIR)/produto_cli.c
GUI_SOURCES = $(VIEW_DIR)/produto_gui.c $(VIEW_DIR)/produto_callbacks.c $(VIEW_DIR)/main_gui.c
ORIGINAL_SOURCES = $(SRC_DIR)/produto.c

# Criar diret√≥rio de build se n√£o existir
$(shell mkdir -p $(BUILD_DIR))

# Compilar tudo
all: original cli gui

# Produto original (PRINCIPAL)
original: $(BUILD_DIR)/$(TARGET_ORIGINAL)

# CLI usando core
cli: $(BUILD_DIR)/$(TARGET_CLI)

# GUI (Interface Gr√°fica)
gui: $(BUILD_DIR)/$(TARGET_GUI)

# Interface Gr√°fica GTK
$(BUILD_DIR)/$(TARGET_GUI): $(GUI_SOURCES) $(CORE_SOURCES)
	$(CC) $(CFLAGS) -I$(SRC_DIR) $(GUI_SOURCES) $(CORE_SOURCES) -o $(BUILD_DIR)/$(TARGET_GUI) $(GTK_CFLAGS) $(GTK_LIBS)
	@echo "‚úÖ GUI compilada com sucesso!"

# CLI usando core  
$(BUILD_DIR)/$(TARGET_CLI): $(CLI_SOURCES) $(CORE_SOURCES)
	$(CC) $(CFLAGS) $(CLI_SOURCES) $(CORE_SOURCES) -o $(BUILD_DIR)/$(TARGET_CLI)
	@echo "‚úÖ CLI (usando core) compilada com sucesso!"

# Produto original
$(BUILD_DIR)/$(TARGET_ORIGINAL): $(ORIGINAL_SOURCES)
	$(CC) $(CFLAGS) -o $(BUILD_DIR)/$(TARGET_ORIGINAL) $(ORIGINAL_SOURCES)
	@echo "‚úÖ Vers√£o original compilada!"

# Executar produto.c 
run: $(BUILD_DIR)/$(TARGET_ORIGINAL)
	@echo "üöÄ Executando produto.c (original)..."
	./$(BUILD_DIR)/$(TARGET_ORIGINAL)

# Executar CLI usando core
run-cli: $(BUILD_DIR)/$(TARGET_CLI)
	@echo "Executando CLI (usando core)..."
	./$(BUILD_DIR)/$(TARGET_CLI)

# Executar GUI
run-gui: $(BUILD_DIR)/$(TARGET_GUI)
	@echo "Executando Interface Gr√°fica..."
	./$(BUILD_DIR)/$(TARGET_GUI)

# Executar vers√£o original
run-original: $(BUILD_DIR)/$(TARGET_ORIGINAL)
	@echo "Executando vers√£o original..."
	./$(BUILD_DIR)/$(TARGET_ORIGINAL)


# Limpar todos os arquivos compilados
clean:
	@echo "üßπ Limpando arquivos compilados..."
	rm -rf $(BUILD_DIR)
	@echo "‚úÖ Limpeza conclu√≠da!"

# Limpar apenas GUI
clean-gui:
	rm -f $(BUILD_DIR)/$(TARGET_GUI)
	@echo "üßπ GUI removida!"


# Rebuild produto.c
rebuild: clean original
	@echo "üîÑ Produto original reconstru√≠do com sucesso!"

# Rebuild CLI
rebuild-cli: clean cli
	@echo "üîÑ CLI reconstru√≠da com sucesso!"

# Rebuild GUI
rebuild-gui: clean gui
	@echo "üîÑ GUI reconstru√≠da com sucesso!"

# Rebuild tudo
rebuild-all: clean all
	@echo "üîÑ Todos os execut√°veis reconstru√≠dos!"


# Instalar depend√™ncias GTK (Ubuntu/Debian)
install-deps:
	@echo "üì¶ Instalando depend√™ncias GTK..."
	sudo apt update
	sudo apt install -y libgtk-3-dev pkg-config

# Verificar se GTK est√° instalado
check-gtk:
	@echo "üîç Verificando GTK..."
	pkg-config --modversion gtk+-3.0 && echo "‚úÖ GTK instalado!" || echo "‚ùå GTK n√£o encontrado!"

# Mostrar ajuda
help:
	@echo "COMANDOS DISPON√çVEIS:"
	@echo ""
	@echo "=== PRINCIPAIS ==="
	@echo "  make run          - Executa produto.c"
	@echo "  make rebuild      - Limpa e recompila produto.c"
	@echo "  make clean        - Remove arquivos compilados"
	@echo ""
	@echo "=== DESENVOLVIMENTO ==="
	@echo "  make original     - Compila apenas produto.c"
	@echo "  make cli          - Compila apenas CLI (com core)"
	@echo "  make gui          - Compila apenas GUI"
	@echo "  make run-cli      - Executa CLI (usando core)"
	@echo "  make run-gui      - Executa interface gr√°fica"
	@echo "  make rebuild-all  - Reconstr√≥i tudo"
	@echo ""
	@echo "=== SETUP ==="
	@echo "  make install-deps - Instala depend√™ncias GTK"
	@echo "  make check-gtk    - Verifica se GTK est√° instalado"

# Targets que n√£o criam arquivos
.PHONY: all cli gui original run run-gui run-cli run-original clean clean-gui rebuild rebuild-gui rebuild-all install-deps check-gtk help